{% extends "base.html" %}

{% block title %}Configuration - MeshCore Bridge{% endblock %}
{% block page_title %}Configuration{% endblock %}

{% block header_actions %}
<button type="submit" form="config-form" class="btn btn-primary btn-sm">
    <i class="fas fa-save"></i>
    Save Changes
</button>
{% endblock %}

{% block content %}

<!-- Information Banner -->
<div class="card mb-4" style="background: linear-gradient(135deg, hsl(var(--primary) / 0.1) 0%, hsl(var(--primary) / 0.05) 100%); border-color: hsl(var(--primary) / 0.3);">
    <div style="padding: 1rem;">
        <div style="display: flex; align-items: start; gap: 1rem;">
            <i class="fas fa-info-circle" style="color: hsl(var(--primary)); font-size: 1.5rem; margin-top: 0.25rem;"></i>
            <div>
                <h3 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; color: hsl(var(--primary));">Bridge Service Configuration</h3>
                <p style="font-size: 0.875rem; margin-bottom: 0.5rem;">This page configures the <strong>background MeshCore Bridge service</strong> for automatic data collection from your primary device.</p>
                <p style="font-size: 0.75rem; color: hsl(var(--muted-foreground)); margin-bottom: 0;">
                    <strong>Note:</strong> This is different from <a href="{% url 'meshcore:connections' %}" style="color: hsl(var(--primary)); text-decoration: underline;">Device Connections</a> which is for interactive device management.
                    <a href="/static/WINDOWS_SETUP.md" target="_blank" style="color: hsl(var(--primary)); text-decoration: underline; margin-left: 0.5rem;">Learn more about the difference â†’</a>
                </p>
            </div>
        </div>
    </div>
</div>

<form method="post" id="config-form">
    {% csrf_token %}
    
    <div class="grid grid-cols-2 gap-4">
        <!-- MQTT Configuration -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">MQTT Configuration</h3>
                <p class="card-description">Configure connection to your MQTT broker</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">MQTT Host</label>
                <input type="text" name="mqtt_host" class="form-input" value="{{ config.mqtt_host }}" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">MQTT Port</label>
                <input type="number" name="mqtt_port" class="form-input" value="{{ config.mqtt_port }}" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Username</label>
                <input type="text" name="mqtt_username" class="form-input" value="{{ config.mqtt_username }}">
            </div>
            
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" name="mqtt_password" class="form-input" value="{{ config.mqtt_password }}">
            </div>
            
            <div class="form-group">
                <label class="form-label">Topic Prefix</label>
                <input type="text" name="mqtt_topic_prefix" class="form-input" value="{{ config.mqtt_topic_prefix }}" required>
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" name="mqtt_tls_enabled" {% if config.mqtt_tls_enabled %}checked{% endif %}>
                    <span class="form-label" style="margin: 0;">Enable TLS/SSL</span>
                </label>
            </div>
        </div>
        
        <!-- RAK4631 Configuration -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">RAK4631 Configuration</h3>
                <p class="card-description">Configure the LoRa device connection</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">Serial Port</label>
                <input type="text" name="rak4631_port" class="form-input" value="{{ config.rak4631_port }}" required>
                <div class="text-xs text-muted" style="margin-top: 0.25rem;">Usually /dev/ttyACM0 or /dev/ttyUSB0</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Baud Rate</label>
                <input type="number" name="rak4631_baud_rate" class="form-input" value="{{ config.rak4631_baud_rate }}" required>
            </div>
        </div>
        
        <!-- Bridge Settings -->
        <div class="card" style="grid-column: span 2;">
            <div class="card-header">
                <h3 class="card-title">Bridge Settings</h3>
                <p class="card-description">Configure bridge behavior and logging</p>
            </div>
            
            <div class="grid grid-cols-3 gap-4">
                <div class="form-group">
                    <label class="form-label">Log Level</label>
                    <select name="log_level" class="form-select">
                        <option value="DEBUG" {% if config.log_level == 'DEBUG' %}selected{% endif %}>Debug</option>
                        <option value="INFO" {% if config.log_level == 'INFO' %}selected{% endif %}>Info</option>
                        <option value="WARNING" {% if config.log_level == 'WARNING' %}selected{% endif %}>Warning</option>
                        <option value="ERROR" {% if config.log_level == 'ERROR' %}selected{% endif %}>Error</option>
                        <option value="CRITICAL" {% if config.log_level == 'CRITICAL' %}selected{% endif %}>Critical</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Reconnect Interval (seconds)</label>
                    <input type="number" name="reconnect_interval" class="form-input" value="{{ config.reconnect_interval }}" required>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 1rem; padding-top: 1.75rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" name="bridge_enabled" {% if config.bridge_enabled %}checked{% endif %}>
                        <span class="form-label" style="margin: 0;">Bridge Enabled</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" name="auto_reconnect" {% if config.auto_reconnect %}checked{% endif %}>
                        <span class="form-label" style="margin: 0;">Auto Reconnect</span>
                    </label>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}
